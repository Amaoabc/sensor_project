#!/bin/bash
# Git预提交钩子 - 检查提交环境

echo "🔍 检查提交环境..."

# 检查是否在VSCode中运行
if [ -z "$VSCODE_IPC_HOOK_CLI" ] && [ "$TERM_PROGRAM" != "vscode" ]; then
    echo "❌ 错误：检测到非VSCode环境提交"
    echo ""
    echo "📌 安全策略："
    echo "   所有Git提交必须在VSCode中进行"
    echo "   这是为了防止版本冲突和数据不一致"
    echo ""
    echo "✅ 正确操作："
    echo "   1. 在VSCode中打开「源代码管理」面板"
    echo "   2. 在「消息」框中输入提交信息"
    echo "   3. 点击「✓ 提交」按钮"
    echo ""
    exit 1
fi

# 检查提交信息长度
COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat $COMMIT_MSG_FILE)

if [ ${#COMMIT_MSG} -lt 10 ]; then
    echo "❌ 错误：提交信息太短（至少10个字符）"
    echo "当前提交信息: \"$COMMIT_MSG\""
    exit 1
fi

echo "✅ 环境检查通过"
exit 0
